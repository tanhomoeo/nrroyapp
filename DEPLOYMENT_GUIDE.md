
# Next.js অ্যাপ্লিকেশন Firebase-এ ডিপ্লয়মেন্ট গাইড

এই নির্দেশিকাটি আপনার Next.js অ্যাপ্লিকেশনটি Firebase প্ল্যাটফর্মে (Firestore ডাটাবেস এবং Firebase App Hosting ব্যবহার করে) ডিপ্লয় করার জন্য একটি ধাপে ধাপে গাইড প্রদান করবে। এখানে দুটি পদ্ধতি আলোচনা করা হয়েছে: ম্যানুয়াল এবং স্বয়ংক্রিয়।

## পূর্বশর্ত

1.  **Node.js এবং npm/yarn:** আপনার সিস্টেমে ইনস্টল করা থাকতে হবে।
2.  **Firebase অ্যাকাউন্ট:** আপনার একটি Firebase অ্যাকাউন্ট থাকতে হবে ([firebase.google.com](https://firebase.google.com)).
3.  **Firebase CLI:** ইনস্টল করা না থাকলে, টার্মিনালে এই কমান্ডটি চালান:
    ```bash
    npm install -g firebase-tools
    ```
4.  **Firebase-এ লগইন:** টার্মিনালে এই কমান্ডটি ব্যবহার করে আপনার Firebase অ্যাকাউন্টে লগইন করুন:
    ```bash
    firebase login
    ```

---

## পদ্ধতি ১: ম্যানুয়াল ডিপ্লয়মেন্ট (টার্মিনাল থেকে)

এই পদ্ধতিতে আপনি নিজের কম্পিউটার থেকে সরাসরি কমান্ড চালিয়ে অ্যাপ্লিকেশন ডিপ্লয় করবেন।

### ধাপ ১. Firebase প্রজেক্ট সেটআপ (যদি না করা হয়ে থাকে)

*   Firebase Console-এ যান ([console.firebase.google.com](https://console.firebase.google.com)) এবং একটি নতুন প্রজেক্ট তৈরি করুন অথবা বিদ্যমান একটি প্রজেক্ট (যেমন `dr-nihar`) নির্বাচন করুন।
*   **Firestore Database:**
    *   আপনার Firebase প্রজেক্টের **Build > Firestore Database** সেকশনে যান।
    *   "Create database" এ ক্লিক করে "Start in production mode" নির্বাচন করুন এবং আপনার পছন্দের লোকেশন সেট করুন।
*   **App Hosting:**
    *   আপনার Firebase প্রজেক্টের **Build > App Hosting** সেকশনে যান।
    *   "Get started" এ ক্লিক করে একটি নতুন ব্যাকএন্ড তৈরি করুন।

### ধাপ ২. লোকাল প্রজেক্টের সাথে Firebase প্রজেক্ট কানেক্ট করা

আপনার লোকাল কোডটি কোন Firebase প্রজেক্টে ডিপ্লয় হবে তা নির্দিষ্ট করতে নিচের কমান্ডটি ব্যবহার করুন:

```bash
firebase login
```
*   কমান্ডটি চালানোর পর তালিকা থেকে আপনার কাঙ্ক্ষিত প্রজেক্টটি নির্বাচন করুন।
*   এই প্রজেক্টের জন্য একটি "alias" (ডাকনাম) দিতে বলা হলে, `default` লিখে **Enter** দিন।

### ধাপ ৩. এনভায়রনমেন্ট ভেরিয়েবল সেটআপ (API Key)

অ্যাপ্লিকেশনটি Google Gemini API ব্যবহার করে, যার জন্য `GOOGLE_GENAI_API_KEY` প্রয়োজন।
*   Firebase Console-এ আপনার App Hosting ব্যাকএন্ডের ড্যাশবোর্ডে যান।
*   **Settings** ট্যাবে যান এবং **Environment variables** সেকশনে `GOOGLE_GENAI_API_KEY` ভেরিয়েবলটি আপনার API Key দিয়ে সেট করুন।

### ধাপ ৪. Next.js অ্যাপ্লিকেশন বিল্ড ও ডিপ্লয় করা

আপনার `firebase.json` ফাইলে `frameworksBackend` কনফিগার করা আছে, তাই Firebase CLI স্বয়ংক্রিয়ভাবে বিল্ড ও ডিপ্লয় করবে।

```bash
firebase deploy --only hosting
```
এই কমান্ডটি প্রথমে আপনার Next.js অ্যাপ্লিকেশনটিকে প্রোডাকশনের জন্য বিল্ড করবে (`npm run build`) এবং তারপর বিল্ড করা ফাইলগুলো Firebase App Hosting-এ আপলোড করবে।

---

## পদ্ধতি ২: স্বয়ংক্রিয় ডিপ্লয়মেন্ট (GitHub Actions - CI/CD)

এই পদ্ধতিতে আপনি আপনার কোড GitHub-এ পুশ করার সাথে সাথে অ্যাপ্লিকেশনটি স্বয়ংক্রিয়ভাবে বিল্ড এবং ডিপ্লয় হয়ে যাবে। এর জন্য আপনাকে একবার GitHub Actions সেটআপ করতে হবে।

### ধাপ ১: GitHub Actions Workflow ফাইল

আপনার প্রজেক্টে `.github/workflows/firebase-app-hosting-deploy.yml` নামে একটি ফাইল যোগ করা হয়েছে। এই ফাইলটি GitHub-কে নির্দেশ দেয় যে `main` ব্রাঞ্চে কোনো কোড পুশ করা হলে স্বয়ংক্রিয়ভাবে Firebase-এ ডিপ্লয় করতে হবে।

### ধাপ ২: GitHub সিক্রেট (Secret) সেটআপ করা (অত্যন্ত জরুরি)

স্বয়ংক্রিয় ডিপ্লয়মেন্টের জন্য GitHub-কে আপনার Firebase প্রজেক্টে অ্যাক্সেস দেওয়ার অনুমতি দিতে হবে। এর জন্য একটি Service Account Key তৈরি করে GitHub-এর সিক্রেট হিসেবে সংরক্ষণ করতে হবে।

**ক) সার্ভিস অ্যাকাউন্ট কী (JSON) তৈরি এবং ডাউনলোড করুন:**
1.  Google Cloud Console-এ যান: [console.cloud.google.com](https://console.cloud.google.com)
2.  উপরে বাম দিকে আপনার Firebase প্রজেক্টটি (যেমন `dr-nihar`) নির্বাচন করা আছে কিনা তা নিশ্চিত করুন।
3.  নেভিগেশন মেনু থেকে **IAM & Admin > Service Accounts**-এ যান।
4.  `firebase-adminsdk` যুক্ত আছে এমন সার্ভিস অ্যাকাউন্টটি খুঁজুন (সাধারণত `firebase-adminsdk-xxxxx@<project-id>.iam.gserviceaccount.com` ফরম্যাটে থাকে)।
5.  ওই সার্ভিস অ্যাকাউন্টের ডানদিকের তিনটি ডট (...) মেনুতে ক্লিক করে **Manage keys**-এ যান।
6.  **ADD KEY > Create new key**-তে ক্লিক করুন।
7.  `JSON` ফরম্যাট নির্বাচন করুন এবং **CREATE** বাটনে ক্লিক করুন। একটি JSON ফাইল আপনার কম্পিউটারে ডাউনলোড হবে।

**খ) GitHub রিপোজিটরিতে সিক্রেট যোগ করুন:**
1.  আপনার GitHub রিপোজিটরিতে যান।
2.  **Settings** ট্যাবে ক্লিক করুন।
3.  বাম পাশের মেনু থেকে **Secrets and variables > Actions** নির্বাচন করুন।
4.  **New repository secret** বাটনে ক্লিক করুন।
5.  **Name** ফিল্ডে লিখুন: `FIREBASE_SERVICE_ACCOUNT_DR_NIHAR`
6.  **Secret** ফিল্ডে, ডাউনলোড করা JSON ফাইলের **সম্পূর্ণ কন্টেন্ট** কপি করে পেস্ট করুন।
7.  **Add secret** বাটনে ক্লিক করে সেভ করুন।

### ধাপ ৩: কোড পুশ করে ডিপ্লয়মেন্ট যাচাই করুন

একবার সিক্রেট সেট হয়ে গেলে, আপনার কাজ শেষ! এখন থেকে যখনি আপনি আপনার লোকাল `main` ব্রাঞ্চ থেকে GitHub-এর `main` ব্রাঞ্চে কোড পুশ করবেন (`git push origin main`), GitHub Actions স্বয়ংক্রিয়ভাবে আপনার জন্য ডিপ্লয়মেন্ট প্রক্রিয়াটি সম্পন্ন করবে। আপনি আপনার রিপোজিটরির **Actions** ট্যাব থেকে ডিপ্লয়মেন্টের অগ্রগতি সরাসরি দেখতে পারবেন।

---

### Firestore নিরাপত্তা বিধি (Security Rules) আপডেট (গুরুত্বপূর্ণ)

আপনার `firestore.rules` ফাইলটি বর্তমানে সম্পূর্ণ খোলা (`allow read, write: if true;`), যা প্রোডাকশনের জন্য অনিরাপদ। আপনাকে অবশ্যই এই বিধিগুলো পরিবর্তন করে আপনার অ্যাপ্লিকেশনের নিরাপত্তা চাহিদা অনুযায়ী সেট করতে হবে এবং `firebase deploy --only firestore:rules` কমান্ড দিয়ে ডিপ্লয় করতে হবে।
